<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>ObraPro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overscroll-behavior: none;
            background: #0f172a;
            user-select: none;
            -webkit-user-select: none;
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .app-container { height: 100vh; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .animate-fade-in { animation: fadeIn 0.3s ease; }
        .animate-slide-up { animation: slideUp 0.3s ease; }
        
        .ios-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .touch-key {
            min-height: 56px;
            touch-action: manipulation;
            transition: all 0.1s;
            border: none;
            font-weight: 600;
            background: white;
            border-radius: 12px;
        }
        .touch-key:active { transform: scale(0.92); background: #e2e8f0; }
        
        .calc-display {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            font-family: 'SF Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
            text-align: right;
            min-height: 64px;
            word-break: break-all;
        }
        
        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 24px 24px 0 0;
            padding: 20px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 200;
            max-height: 90vh;
            overflow-y: auto;
        }
        .bottom-sheet.open { transform: translateY(0); }
        
        .sheet-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 199;
        }
        .sheet-overlay.open { opacity: 1; pointer-events: auto; }
        
        .fab {
            position: fixed;
            bottom: calc(20px + env(safe-area-inset-bottom));
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
            z-index: 100;
            border: none;
        }
        .fab:active { transform: scale(0.9); }
        
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: #1e293b;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }
        
        .obra-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: white;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            color: #475569;
            border: 2px solid #e2e8f0;
            white-space: nowrap;
        }
        .obra-chip.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        input, select {
            font-size: 16px !important;
            border: 2px solid #e2e8f0;
            background: #f8fafc;
            border-radius: 12px;
            padding: 12px 16px;
            width: 100%;
            outline: none;
        }
        input:focus, select:focus {
            border-color: #3b82f6;
            background: white;
        }
        
        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .photo-thumb { aspect-ratio: 1; border-radius: 12px; overflow: hidden; position: relative; background: #f1f5f9; }
        .photo-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .photo-thumb .delete {
            position: absolute; top: 4px; right: 4px;
            width: 24px; height: 24px;
            background: rgba(239, 68, 68, 0.9);
            color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; border: none;
        }
        
        .photo-modal {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s;
        }
        .photo-modal.open { opacity: 1; pointer-events: auto; }
        .photo-modal img { max-width: 90%; max-height: 80vh; border-radius: 12px; }
        
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 16px; }
        .menu-item {
            aspect-ratio: 1; background: white;
            border-radius: 16px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            gap: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
        }
        .menu-item svg { width: 28px; height: 28px; color: #3b82f6; }
        .menu-item span { font-size: 11px; font-weight: 600; color: #475569; text-align: center; }
        
        /* Botones de acci√≥n en items */
        .item-actions {
            display: flex;
            gap: 8px;
        }
        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            transition: all 0.2s;
        }
        .btn-icon:active { transform: scale(0.9); }
        .btn-edit { background: #dbeafe; color: #2563eb; }
        .btn-delete { background: #fee2e2; color: #dc2626; }
        
        .obra-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
    <div id="root" class="app-container safe-top safe-bottom"></div>
    <div id="toast" class="toast"></div>

    <script>
        window.showToast = (msg, type = 'success') => {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 2500);
        };
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error:', err));
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Database mejorado con funciones de edici√≥n
        const DB = {
            get: (key) => JSON.parse(localStorage.getItem(key) || '[]'),
            set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
            
            saveItem: (store, item) => {
                const data = DB.get(store);
                // Si ya existe (tiene id), actualizar; si no, agregar
                const index = data.findIndex(i => i.id === item.id);
                if (index >= 0) {
                    data[index] = { ...data[index], ...item, updatedAt: Date.now() };
                } else {
                    data.unshift({ ...item, id: item.id || (store + '_' + Date.now()), createdAt: Date.now() });
                }
                DB.set(store, data);
                return item;
            },
            
            deleteItem: (store, id) => {
                const data = DB.get(store).filter(i => i.id !== id);
                DB.set(store, data);
            },
            
            getItem: (store, id) => {
                return DB.get(store).find(i => i.id === id);
            }
        };

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [obraActual, setObraActual] = useState(null);
            const [obras, setObras] = useState([]);
            const [vista, setVista] = useState('dashboard');
            const [showForm, setShowForm] = useState(false);
            const [showObraForm, setShowObraForm] = useState(false);
            const [showEditModal, setShowEditModal] = useState(false);
            const [showPhotoModal, setShowPhotoModal] = useState(null);
            const [formType, setFormType] = useState('medicion');
            const [editando, setEditando] = useState(null); // Item que se est√° editando
            
            const [mediciones, setMediciones] = useState([]);
            const [horas, setHoras] = useState([]);
            const [materiales, setMateriales] = useState([]);
            const [personal, setPersonal] = useState([]);
            const [gastos, setGastos] = useState([]);
            
            // Forms
            const [medForm, setMedForm] = useState({ tipo: 'Tabique', desc: '', valor: '', mult: '', unidad: 'm', precio: '' });
            const [horaForm, setHoraForm] = useState({ desc: '', inicio: '', fin: '', fecha: new Date().toISOString().split('T')[0], descanso: 0, fotos: [] });
            const [obraForm, setObraForm] = useState({ nombre: '', cliente: '', direccion: '', telefono: '', email: '', presupuesto: '' });
            const [matForm, setMatForm] = useState({ nombre: '', cantidad: '', unidad: '', precioUnitario: '', proveedor: '' });
            const [persForm, setPersForm] = useState({ nombre: '', cargo: '', telefono: '', salarioDia: '' });
            const [gastoForm, setGastoForm] = useState({ concepto: '', monto: '', categoria: 'material', fecha: new Date().toISOString().split('T')[0] });

            useEffect(() => {
                const savedUser = localStorage.getItem('obrapro_user');
                const savedObras = DB.get('obras');
                
                if (savedUser) setUser(JSON.parse(savedUser));
                setObras(savedObras);
                if (savedObras.length > 0 && !obraActual) {
                    setObraActual(savedObras[0]);
                    cargarDatosObra(savedObras[0].id);
                }
                setLoading(false);
            }, []);

            const cargarDatosObra = (obraId) => {
                setMediciones(DB.get('mediciones').filter(m => m.obraId === obraId));
                setHoras(DB.get('horas').filter(h => h.obraId === obraId));
                setMateriales(DB.get('materiales').filter(m => m.obraId === obraId));
                setPersonal(DB.get('personal').filter(p => p.obraId === obraId));
                setGastos(DB.get('gastos').filter(g => g.obraId === obraId));
            };

            const login = (email, nombre) => {
                const newUser = { id: Date.now(), email, nombre };
                localStorage.setItem('obrapro_user', JSON.stringify(newUser));
                setUser(newUser);
                window.showToast('¬°Bienvenido!');
            };

            const logout = () => {
                localStorage.removeItem('obrapro_user');
                setUser(null);
            };

            // ========== CREAR Y EDITAR OBRAS ==========
            const guardarObra = () => {
                if (!obraForm.nombre) {
                    window.showToast('El nombre es obligatorio', 'error');
                    return;
                }
                
                const obra = {
                    id: editando?.id || 'obra_' + Date.now(),
                    ...obraForm,
                    fechaCreacion: editando?.fechaCreacion || new Date().toLocaleDateString('es-ES'),
                    updatedAt: Date.now()
                };
                
                DB.saveItem('obras', obra);
                const nuevasObras = DB.get('obras');
                setObras(nuevasObras);
                setObraActual(obra);
                setShowObraForm(false);
                setEditando(null);
                setObraForm({ nombre: '', cliente: '', direccion: '', telefono: '', email: '', presupuesto: '' });
                window.showToast(editando ? 'Obra actualizada' : 'Obra creada');
            };

            const editarObra = (obra) => {
                setEditando(obra);
                setObraForm({
                    nombre: obra.nombre,
                    cliente: obra.cliente || '',
                    direccion: obra.direccion || '',
                    telefono: obra.telefono || '',
                    email: obra.email || '',
                    presupuesto: obra.presupuesto || ''
                });
                setShowObraForm(true);
            };

            const eliminarObra = (obraId) => {
                if (!confirm('¬øEliminar esta obra y todos sus datos?')) return;
                DB.deleteItem('obras', obraId);
                // Eliminar datos relacionados
                ['mediciones', 'horas', 'materiales', 'personal', 'gastos'].forEach(tipo => {
                    DB.get(tipo).filter(i => i.obraId === obraId).forEach(i => DB.deleteItem(tipo, i.id));
                });
                const nuevas = DB.get('obras');
                setObras(nuevas);
                setObraActual(nuevas[0] || null);
                if (nuevas[0]) cargarDatosObra(nuevas[0].id);
                window.showToast('Obra eliminada');
            };

            // ========== MEDICIONES ==========
            const clickTecla = (t) => {
                if (t === 'C') setMedForm(p => ({...p, valor: ''}));
                else if (t === '‚Üê') setMedForm(p => ({...p, valor: p.valor.slice(0, -1)}));
                else if (t === '+') setMedForm(p => ({...p, valor: p.valor.endsWith('+') ? p.valor : p.valor + '+'}));
                else setMedForm(p => ({...p, valor: p.valor + t}));
            };

            const guardarMedicion = () => {
                if (!obraActual || !medForm.valor) return;
                
                const suma = medForm.valor.split('+').reduce((a, b) => a + (parseFloat(b) || 0), 0);
                const mult = parseFloat(medForm.mult) || 0;
                const precio = parseFloat(medForm.precio) || 0;
                
                const medicion = {
                    id: editando?.id || 'med_' + Date.now(),
                    obraId: obraActual.id,
                    tipo: medForm.tipo,
                    desc: medForm.desc || 'Sin descripci√≥n',
                    valor: medForm.valor,
                    mult,
                    unidad: medForm.unidad,
                    totalL: suma.toFixed(2),
                    totalS: (suma * mult).toFixed(2),
                    precio,
                    totalPrecio: (suma * mult * precio).toFixed(2),
                    fecha: editando?.fecha || new Date().toLocaleDateString('es-ES')
                };
                
                DB.saveItem('mediciones', medicion);
                cargarDatosObra(obraActual.id);
                cerrarFormMedicion();
                window.showToast(editando ? 'Medici√≥n actualizada' : 'Medici√≥n guardada');
            };

            const editarMedicion = (med) => {
                setEditando(med);
                setMedForm({
                    tipo: med.tipo,
                    desc: med.desc,
                    valor: med.valor,
                    mult: med.mult,
                    unidad: med.unidad,
                    precio: med.precio
                });
                setFormType('medicion');
                setShowForm(true);
            };

            const cerrarFormMedicion = () => {
                setShowForm(false);
                setEditando(null);
                setMedForm({ tipo: 'Tabique', desc: '', valor: '', mult: '', unidad: 'm', precio: '' });
            };

            // ========== HORAS ==========
            const guardarHora = () => {
                if (!obraActual || !horaForm.inicio || !horaForm.fin) return;
                
                const h1 = new Date(`2000-01-01T${horaForm.inicio}`);
                const h2 = new Date(`2000-01-01T${horaForm.fin}`);
                let horas = (h2 - h1) / 3600000 - (parseFloat(horaForm.descanso) || 0) / 60;
                
                if (horas <= 0) {
                    window.showToast('Hora fin debe ser mayor', 'error');
                    return;
                }

                const hora = {
                    id: editando?.id || 'hora_' + Date.now(),
                    obraId: obraActual.id,
                    desc: horaForm.desc || 'Sin descripci√≥n',
                    inicio: horaForm.inicio,
                    fin: horaForm.fin,
                    fecha: horaForm.fecha,
                    descanso: horaForm.descanso,
                    total: horas.toFixed(2),
                    fotos: editando ? editando.fotos : horaForm.fotos.length
                };
                
                DB.saveItem('horas', hora);
                
                // Guardar fotos nuevas
                if (!editando && horaForm.fotos.length > 0) {
                    horaForm.fotos.forEach((foto, i) => {
                        DB.saveItem('fotos', {
                            id: `foto_${hora.id}_${i}`,
                            horaId: hora.id,
                            obraId: obraActual.id,
                            data: foto
                        });
                    });
                }
                
                cargarDatosObra(obraActual.id);
                cerrarFormHora();
                window.showToast(editando ? 'Hora actualizada' : 'Horas guardadas');
            };

            const editarHora = (hora) => {
                setEditando(hora);
                setHoraForm({
                    desc: hora.desc,
                    inicio: hora.inicio,
                    fin: hora.fin,
                    fecha: hora.fecha,
                    descanso: hora.descanso,
                    fotos: []
                });
                setFormType('horas');
                setShowForm(true);
            };

            const cerrarFormHora = () => {
                setShowForm(false);
                setEditando(null);
                setHoraForm({ desc: '', inicio: '', fin: '', fecha: new Date().toISOString().split('T')[0], descanso: 0, fotos: [] });
            };

            // ========== MATERIALES ==========
            const guardarMaterial = () => {
                if (!obraActual || !matForm.nombre) return;
                
                const material = {
                    id: editando?.id || 'mat_' + Date.now(),
                    obraId: obraActual.id,
                    ...matForm,
                    total: (parseFloat(matForm.cantidad) * parseFloat(matForm.precioUnitario || 0)).toFixed(2),
                    fecha: editando?.fecha || new Date().toLocaleDateString('es-ES')
                };
                
                DB.saveItem('materiales', material);
                cargarDatosObra(obraActual.id);
                cerrarFormMaterial();
                window.showToast(editando ? 'Material actualizado' : 'Material guardado');
            };

            const editarMaterial = (mat) => {
                setEditando(mat);
                setMatForm({
                    nombre: mat.nombre,
                    cantidad: mat.cantidad,
                    unidad: mat.unidad,
                    precioUnitario: mat.precioUnitario,
                    proveedor: mat.proveedor
                });
                setFormType('material');
                setShowForm(true);
            };

            const cerrarFormMaterial = () => {
                setShowForm(false);
                setEditando(null);
                setMatForm({ nombre: '', cantidad: '', unidad: '', precioUnitario: '', proveedor: '' });
            };

            // ========== PERSONAL ==========
            const guardarPersonal = () => {
                if (!obraActual || !persForm.nombre) return;
                
                const person = {
                    id: editando?.id || 'pers_' + Date.now(),
                    obraId: obraActual.id,
                    ...persForm,
                    fechaRegistro: editando?.fechaRegistro || new Date().toLocaleDateString('es-ES')
                };
                
                DB.saveItem('personal', person);
                cargarDatosObra(obraActual.id);
                cerrarFormPersonal();
                window.showToast(editando ? 'Personal actualizado' : 'Personal guardado');
            };

            const editarPersonal = (pers) => {
                setEditando(pers);
                setPersForm({
                    nombre: pers.nombre,
                    cargo: pers.cargo,
                    telefono: pers.telefono,
                    salarioDia: pers.salarioDia
                });
                setFormType('personal');
                setShowForm(true);
            };

            const cerrarFormPersonal = () => {
                setShowForm(false);
                setEditando(null);
                setPersForm({ nombre: '', cargo: '', telefono: '', salarioDia: '' });
            };

            // ========== GASTOS ==========
            const guardarGasto = () => {
                if (!obraActual || !gastoForm.concepto) return;
                
                const gasto = {
                    id: editando?.id || 'gasto_' + Date.now(),
                    obraId: obraActual.id,
                    ...gastoForm
                };
                
                DB.saveItem('gastos', gasto);
                cargarDatosObra(obraActual.id);
                cerrarFormGasto();
                window.showToast(editando ? 'Gasto actualizado' : 'Gasto guardado');
            };

            const editarGasto = (gasto) => {
                setEditando(gasto);
                setGastoForm({
                    concepto: gasto.concepto,
                    monto: gasto.monto,
                    categoria: gasto.categoria,
                    fecha: gasto.fecha
                });
                setFormType('gasto');
                setShowForm(true);
            };

            const cerrarFormGasto = () => {
                setShowForm(false);
                setEditando(null);
                setGastoForm({ concepto: '', monto: '', categoria: 'material', fecha: new Date().toISOString().split('T')[0] });
            };

            // ========== ELIMINAR GEN√âRICO ==========
            const eliminarItem = (tipo, id) => {
                if (!confirm('¬øEliminar este registro?')) return;
                DB.deleteItem(tipo, id);
                cargarDatosObra(obraActual.id);
                window.showToast('Eliminado');
            };

            // ========== FOTOS ==========
            const tomarFoto = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.capture = 'environment';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onloadend = () => setHoraForm(p => ({...p, fotos: [...p.fotos, reader.result]}));
                    reader.readAsDataURL(file);
                };
                input.click();
            };

            const eliminarFoto = (idx) => setHoraForm(p => ({...p, fotos: p.fotos.filter((_, i) => i !== idx)}));

            // ========== EXPORTAR ==========
            const exportarPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFillColor(15, 23, 42);
                doc.rect(0, 0, 210, 40, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.text(obraActual?.nombre || 'INFORME', 105, 20, { align: 'center' });
                doc.setFontSize(10);
                doc.text(`Fecha: ${new Date().toLocaleDateString('es-ES')}`, 105, 32, { align: 'center' });
                
                let y = 50;
                
                if (mediciones.length > 0) {
                    doc.setFontSize(14);
                    doc.text('MEDICIONES', 14, y);
                    y += 10;
                    doc.autoTable({
                        head: [['Fecha', 'Tipo', 'Descripci√≥n', 'm¬≤', 'Total']],
                        body: mediciones.map(m => [m.fecha, m.tipo, m.desc.substring(0, 25), m.totalS, m.totalPrecio ? '$' + m.totalPrecio : '-']),
                        startY: y,
                        theme: 'striped',
                        headStyles: { fillColor: [37, 99, 235] }
                    });
                    y = doc.lastAutoTable.finalY + 15;
                }
                
                if (horas.length > 0) {
                    doc.setFontSize(14);
                    doc.text('HORAS', 14, y);
                    y += 10;
                    doc.autoTable({
                        head: [['Fecha', 'Descripci√≥n', 'Horario', 'Total']],
                        body: horas.map(h => [h.fecha, h.desc.substring(0, 30), `${h.inicio}-${h.fin}`, h.total + 'h']),
                        startY: y,
                        theme: 'striped',
                        headStyles: { fillColor: [16, 185, 129] }
                    });
                }
                
                doc.save(`Obra_${obraActual?.nombre}_${new Date().toISOString().split('T')[0]}.pdf`);
                window.showToast('PDF generado');
            };

            // ========== STATS ==========
            const stats = {
                totalML: mediciones.reduce((a, b) => a + parseFloat(b.totalL), 0),
                totalM2: mediciones.reduce((a, b) => a + parseFloat(b.totalS), 0),
                totalPrecio: mediciones.reduce((a, b) => a + parseFloat(b.totalPrecio || 0), 0),
                totalHoras: horas.reduce((a, b) => a + parseFloat(b.total), 0),
                totalMateriales: materiales.reduce((a, b) => a + parseFloat(b.total || 0), 0),
                totalGastos: gastos.reduce((a, b) => a + parseFloat(b.monto || 0), 0)
            };

            if (loading) {
                return (
                    <div className="flex-1 flex items-center justify-center text-white">
                        <div className="text-center">
                            <div className="w-20 h-20 bg-blue-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
                                <span className="text-3xl font-black">OP</span>
                            </div>
                            <p className="font-bold text-lg">ObraPro</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return <LoginScreen onLogin={login} />;
            }

            return (
                <>
                    <header className="bg-slate-900 text-white px-4 py-3">
                        <div className="flex justify-between items-center mb-3">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center">
                                    <span className="font-black text-lg">OP</span>
                                </div>
                                <div>
                                    <h1 className="font-black text-sm">ObraPro</h1>
                                    <p className="text-xs text-slate-400">Buen Camino</p>
                                </div>
                            </div>
                            <button onClick={logout} className="text-xs text-slate-400">Salir</button>
                        </div>
                        
                        <div className="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                            {obras.map(o => (
                                <div key={o.id} className="relative group">
                                    <button 
                                        onClick={() => { setObraActual(o); cargarDatosObra(o.id); }}
                                        className={`obra-chip ${obraActual?.id === o.id ? 'active' : ''}`}
                                    >
                                        {o.nombre}
                                    </button>
                                    {obraActual?.id === o.id && (
                                        <button 
                                            onClick={(e) => { e.stopPropagation(); editarObra(o); }}
                                            className="absolute -top-1 -right-1 w-5 h-5 bg-amber-400 text-white rounded-full text-xs flex items-center justify-center shadow-md"
                                        >
                                            ‚úèÔ∏è
                                        </button>
                                    )}
                                </div>
                            ))}
                            <button onClick={() => { setEditando(null); setObraForm({ nombre: '', cliente: '', direccion: '', telefono: '', email: '', presupuesto: '' }); setShowObraForm(true); }} className="obra-chip bg-slate-800 text-slate-400 border-slate-700 text-xs">
                                + Nueva
                            </button>
                        </div>
                    </header>

                    {vista === 'dashboard' && (
                        <main className="flex-1 overflow-y-auto no-scrollbar p-4">
                            {!obraActual ? (
                                <div className="text-center text-white py-20">
                                    <p className="mb-4">Crea tu primera obra</p>
                                    <button onClick={() => setShowObraForm(true)} className="px-6 py-3 bg-blue-600 rounded-xl font-bold">Crear Obra</button>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <div className="ios-card p-4 bg-gradient-to-br from-blue-600 to-purple-600 text-white">
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <p className="text-xs text-blue-200 mb-1">{obraActual.nombre}</p>
                                                <p className="text-sm opacity-90">{obraActual.cliente}</p>
                                                <p className="text-xs opacity-75">{obraActual.direccion}</p>
                                            </div>
                                            <button onClick={() => editarObra(obraActual)} className="p-2 bg-white/20 rounded-lg text-xs">
                                                ‚úèÔ∏è Editar
                                            </button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-white/20">
                                            <div>
                                                <p className="text-2xl font-black">{stats.totalML.toFixed(2)}</p>
                                                <p className="text-xs text-blue-200">metros</p>
                                            </div>
                                            <div>
                                                <p className="text-2xl font-black">{stats.totalHoras.toFixed(2)}h</p>
                                                <p className="text-xs text-blue-200">horas</p>
                                            </div>
                                        </div>
                                        {stats.totalPrecio > 0 && (
                                            <p className="mt-3 pt-3 border-t border-white/20 text-lg font-bold">${stats.totalPrecio.toFixed(2)}</p>
                                        )}
                                    </div>

                                    <div className="menu-grid">
                                        <div className="menu-item" onClick={() => setVista('mediciones')}>
                                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                                            <span>Mediciones</span>
                                            {mediciones.length > 0 && <span className="absolute top-1 right-1 bg-blue-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">{mediciones.length}</span>}
                                        </div>
                                        <div className="menu-item" onClick={() => setVista('horas')}>
                                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                                            <span>Horas</span>
                                            {horas.length > 0 && <span className="absolute top-1 right-1 bg-emerald-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">{horas.length}</span>}
                                        </div>
                                        <div className="menu-item" onClick={() => setVista('materiales')}>
                                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
                                            <span>Materiales</span>
                                        </div>
                                        <div className="menu-item" onClick={() => setVista('personal')}>
                                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                                            <span>Personal</span>
                                        </div>
                                        <div className="menu-item" onClick={() => setVista('gastos')}>
                                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                            <span>Gastos</span>
                                        </div>
                                        <div className="menu-item" onClick={exportarPDF}>
                                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                            <span>PDF</span>
                                        </div>
                                    </div>

                                    {mediciones.length > 0 && (
                                        <div className="ios-card p-4">
                                            <h3 className="text-sm font-bold text-slate-500 mb-3">√öltimas mediciones</h3>
                                            {mediciones.slice(0, 3).map(m => (
                                                <div key={m.id} className="flex justify-between items-center py-2 border-b last:border-0">
                                                    <div>
                                                        <span className="text-xs font-bold text-blue-500">{m.tipo}</span>
                                                        <p className="text-sm font-medium">{m.desc}</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="font-bold">{m.totalL} ml</p>
                                                        <p className="text-xs text-emerald-600">{m.totalS} m¬≤</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                        </main>
                    )}

                    {vista === 'mediciones' && (
                        <VistaLista 
                            titulo="Mediciones" 
                            items={mediciones} 
                            onBack={() => setVista('dashboard')}
                            onEdit={editarMedicion}
                            onDelete={(id) => eliminarItem('mediciones', id)}
                            renderItem={m => (
                                <>
                                    <div>
                                        <span className="text-xs font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded">{m.tipo}</span>
                                        <p className="font-medium text-sm mt-1">{m.desc}</p>
                                        <p className="text-xs text-slate-400">{m.fecha}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="font-bold text-lg">{m.totalL} ml</p>
                                        <p className="text-xs text-emerald-600">{m.totalS} m¬≤</p>
                                        {m.precio > 0 && <p className="text-xs text-amber-600">${m.totalPrecio}</p>}
                                    </div>
                                </>
                            )}
                        />
                    )}

                    {vista === 'horas' && (
                        <VistaLista 
                            titulo="Horas Trabajadas" 
                            items={horas}
                            onBack={() => setVista('dashboard')}
                            onEdit={editarHora}
                            onDelete={(id) => eliminarItem('horas', id)}
                            renderItem={h => (
                                <>
                                    <div>
                                        <p className="font-medium">{h.desc}</p>
                                        <p className="text-xs text-slate-400">{h.fecha} ‚Ä¢ {h.inicio}-{h.fin}</p>
                                        {h.fotos > 0 && <p className="text-xs text-blue-500 mt-1">üì∑ {h.fotos} fotos</p>}
                                    </div>
                                    <p className="font-bold text-emerald-600 text-xl">{h.total}h</p>
                                </>
                            )}
                        />
                    )}

                    {vista === 'materiales' && (
                        <VistaLista 
                            titulo="Materiales" 
                            items={materiales}
                            onBack={() => setVista('dashboard')}
                            onEdit={editarMaterial}
                            onDelete={(id) => eliminarItem('materiales', id)}
                            renderItem={m => (
                                <>
                                    <div>
                                        <p className="font-medium">{m.nombre}</p>
                                        <p className="text-xs text-slate-400">{m.cantidad} {m.unidad} ‚Ä¢ {m.proveedor}</p>
                                    </div>
                                    <p className="font-bold">${m.total}</p>
                                </>
                            )}
                        />
                    )}

                    {vista === 'personal' && (
                        <VistaLista 
                            titulo="Personal" 
                            items={personal}
                            onBack={() => setVista('dashboard')}
                            onEdit={editarPersonal}
                            onDelete={(id) => eliminarItem('personal', id)}
                            renderItem={p => (
                                <>
                                    <div>
                                        <p className="font-medium">{p.nombre}</p>
                                        <p className="text-xs text-slate-400">{p.cargo} ‚Ä¢ {p.telefono}</p>
                                    </div>
                                    <p className="text-sm font-bold text-blue-600">${p.salarioDia}/d√≠a</p>
                                </>
                            )}
                        />
                    )}

                    {vista === 'gastos' && (
                        <VistaLista 
                            titulo="Gastos" 
                            items={gastos}
                            onBack={() => setVista('dashboard')}
                            onEdit={editarGasto}
                            onDelete={(id) => eliminarItem('gastos', id)}
                            renderItem={g => (
                                <>
                                    <div>
                                        <p className="font-medium">{g.concepto}</p>
                                        <p className="text-xs text-slate-400">{g.fecha} ‚Ä¢ {g.categoria}</p>
                                    </div>
                                    <p className="font-bold text-red-500">-${g.monto}</p>
                                </>
                            )}
                        />
                    )}

                    {obraActual && vista === 'dashboard' && (
                        <button onClick={() => { setEditando(null); setShowForm(true); }} className="fab">
                            <svg width="24" height="24" fill="none" stroke="white" strokeWidth="2" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
                        </button>
                    )}

                    {/* Modal Nueva/Editar Obra */}
                    <div className={`sheet-overlay ${showObraForm ? 'open' : ''}`} onClick={() => setShowObraForm(false)}></div>
                    <div className={`bottom-sheet ${showObraForm ? 'open' : ''}`}>
                        <div className="w-12 h-1 bg-slate-300 rounded-full mx-auto mb-4"></div>
                        <h2 className="text-xl font-bold mb-4">{editando ? 'Editar Obra' : 'Nueva Obra'}</h2>
                        <div className="space-y-3">
                            <input placeholder="Nombre *" value={obraForm.nombre} onChange={e => setObraForm({...obraForm, nombre: e.target.value})} />
                            <input placeholder="Cliente" value={obraForm.cliente} onChange={e => setObraForm({...obraForm, cliente: e.target.value})} />
                            <input placeholder="Direcci√≥n" value={obraForm.direccion} onChange={e => setObraForm({...obraForm, direccion: e.target.value})} />
                            <input placeholder="Tel√©fono" value={obraForm.telefono} onChange={e => setObraForm({...obraForm, telefono: e.target.value})} />
                            <input placeholder="Email" type="email" value={obraForm.email} onChange={e => setObraForm({...obraForm, email: e.target.value})} />
                            <input placeholder="Presupuesto $" type="number" value={obraForm.presupuesto} onChange={e => setObraForm({...obraForm, presupuesto: e.target.value})} />
                            
                            <div className="flex gap-2">
                                {editando && (
                                    <button onClick={() => { eliminarObra(editando.id); setShowObraForm(false); }} className="flex-1 py-3 bg-red-100 text-red-600 font-bold rounded-xl">
                                        üóëÔ∏è Eliminar
                                    </button>
                                )}
                                <button onClick={guardarObra} className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl">
                                    {editando ? 'üíæ GUARDAR CAMBIOS' : 'CREAR OBRA'}
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Modal Formulario Mediciones/Horas/etc */}
                    <div className={`sheet-overlay ${showForm ? 'open' : ''}`} onClick={() => setShowForm(false)}></div>
                    <div className={`bottom-sheet ${showForm ? 'open' : ''}`}>
                        <div className="w-12 h-1 bg-slate-300 rounded-full mx-auto mb-4"></div>
                        
                        <div className="flex gap-2 mb-4 overflow-x-auto">
                            {['medicion', 'horas', 'material', 'personal', 'gasto'].map(t => (
                                <button key={t} onClick={() => setFormType(t)} className={`px-3 py-2 rounded-full text-xs font-bold capitalize ${formType === t ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600'}`}>
                                    {t}
                                </button>
                            ))}
                        </div>

                        {formType === 'medicion' && (
                            <div className="space-y-3">
                                <select value={medForm.tipo} onChange={e => setMedForm({...medForm, tipo: e.target.value})} className="font-bold">
                                    <option>Tabique</option><option>Techo</option><option>Caj√≥n ML</option><option>Tabica</option><option>Cantonera</option><option>Muro</option><option>Piso</option>
                                </select>
                                <input placeholder="Descripci√≥n" value={medForm.desc} onChange={e => setMedForm({...medForm, desc: e.target.value})} />
                                <div className="calc-display">{medForm.valor || "0"} {medForm.unidad}</div>
                                <div className="grid grid-cols-4 gap-2">
                                    {['7','8','9','+','4','5','6','‚Üê','1','2','3','C','.','0'].map(t => (
                                        <button key={t} onClick={() => clickTecla(t)} className={`touch-key ${['+','‚Üê','C'].includes(t) ? 'bg-slate-200' : ''}`}>{t === '‚Üê' ? '‚å´' : t}</button>
                                    ))}
                                </div>
                                <div className="flex gap-2">
                                    <input placeholder="Altura/Ancho" type="number" value={medForm.mult} onChange={e => setMedForm({...medForm, mult: e.target.value})} />
                                    <input placeholder="Precio/m¬≤" type="number" value={medForm.precio} onChange={e => setMedForm({...medForm, precio: e.target.value})} />
                                </div>
                                <div className="flex gap-2">
                                    {editando && (
                                        <button onClick={() => { eliminarItem('mediciones', editando.id); cerrarFormMedicion(); }} className="flex-1 py-3 bg-red-100 text-red-600 font-bold rounded-xl">
                                            üóëÔ∏è Eliminar
                                        </button>
                                    )}
                                    <button onClick={guardarMedicion} className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl">
                                        {editando ? 'üíæ GUARDAR' : 'GUARDAR'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {formType === 'horas' && (
                            <div className="space-y-3">
                                <input placeholder="Descripci√≥n de la tarea" value={horaForm.desc} onChange={e => setHoraForm({...horaForm, desc: e.target.value})} />
                                <div className="grid grid-cols-2 gap-2">
                                    <input type="time" value={horaForm.inicio} onChange={e => setHoraForm({...horaForm, inicio: e.target.value})} />
                                    <input type="time" value={horaForm.fin} onChange={e => setHoraForm({...horaForm, fin: e.target.value})} />
                                </div>
                                <input type="number" placeholder="Descanso (min)" value={horaForm.descanso} onChange={e => setHoraForm({...horaForm, descanso: e.target.value})} />
                                
                                {!editando && horaForm.fotos.length > 0 && (
                                    <div className="photo-grid">
                                        {horaForm.fotos.map((f, i) => (
                                            <div key={i} className="photo-thumb">
                                                <img src={f} />
                                                <button onClick={() => eliminarFoto(i)} className="delete">√ó</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {!editando && (
                                    <button onClick={tomarFoto} className="w-full py-3 bg-amber-500 text-white font-bold rounded-xl flex items-center justify-center gap-2">
                                        üì∑ {horaForm.fotos.length > 0 ? 'Agregar otra foto' : 'Tomar foto'}
                                    </button>
                                )}
                                
                                <div className="flex gap-2">
                                    {editando && (
                                        <button onClick={() => { eliminarItem('horas', editando.id); cerrarFormHora(); }} className="flex-1 py-3 bg-red-100 text-red-600 font-bold rounded-xl">
                                            üóëÔ∏è Eliminar
                                        </button>
                                    )}
                                    <button onClick={guardarHora} className="flex-1 py-3 bg-emerald-600 text-white font-bold rounded-xl">
                                        {editando ? 'üíæ GUARDAR' : 'GUARDAR HORAS'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {formType === 'material' && (
                            <div className="space-y-3">
                                <input placeholder="Nombre del material" value={matForm.nombre} onChange={e => setMatForm({...matForm, nombre: e.target.value})} />
                                <div className="flex gap-2">
                                    <input placeholder="Cantidad" type="number" value={matForm.cantidad} onChange={e => setMatForm({...matForm, cantidad: e.target.value})} />
                                    <input placeholder="Unidad" value={matForm.unidad} onChange={e => setMatForm({...matForm, unidad: e.target.value})} className="w-24" />
                                </div>
                                <input placeholder="Precio unitario" type="number" value={matForm.precioUnitario} onChange={e => setMatForm({...matForm, precioUnitario: e.target.value})} />
                                <input placeholder="Proveedor" value={matForm.proveedor} onChange={e => setMatForm({...matForm, proveedor: e.target.value})} />
                                <div className="flex gap-2">
                                    {editando && (
                                        <button onClick={() => { eliminarItem('materiales', editando.id); cerrarFormMaterial(); }} className="flex-1 py-3 bg-red-100 text-red-600 font-bold rounded-xl">
                                            üóëÔ∏è Eliminar
                                        </button>
                                    )}
                                    <button onClick={guardarMaterial} className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl">
                                        {editando ? 'üíæ GUARDAR' : 'GUARDAR'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {formType === 'personal' && (
                            <div className="space-y-3">
                                <input placeholder="Nombre completo" value={persForm.nombre} onChange={e => setPersForm({...persForm, nombre: e.target.value})} />
                                <input placeholder="Cargo" value={persForm.cargo} onChange={e => setPersForm({...persForm, cargo: e.target.value})} />
                                <input placeholder="Tel√©fono" value={persForm.telefono} onChange={e => setPersForm({...persForm, telefono: e.target.value})} />
                                <input placeholder="Salario por d√≠a" type="number" value={persForm.salarioDia} onChange={e => setPersForm({...persForm, salarioDia: e.target.value})} />
                                <div className="flex gap-2">
                                    {editando && (
                                        <button onClick={() => { eliminarItem('personal', editando.id); cerrarFormPersonal(); }} className="flex-1 py-3 bg-red-100 text-red-600 font-bold rounded-xl">
                                            üóëÔ∏è Eliminar
                                        </button>
                                    )}
                                    <button onClick={guardarPersonal} className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl">
                                        {editando ? 'üíæ GUARDAR' : 'GUARDAR'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {formType === 'gasto' && (
                            <div className="space-y-3">
                                <input placeholder="Concepto" value={gastoForm.concepto} onChange={e => setGastoForm({...gastoForm, concepto: e.target.value})} />
                                <input placeholder="Monto" type="number" value={gastoForm.monto} onChange={e => setGastoForm({...gastoForm, monto: e.target.value})} />
                                <select value={gastoForm.categoria} onChange={e => setGastoForm({...gastoForm, categoria: e.target.value})}>
                                    <option value="material">Material</option>
                                    <option value="transporte">Transporte</option>
                                    <option value="comida">Comida</option>
                                    <option value="herramienta">Herramienta</option>
                                    <option value="otro">Otro</option>
                                </select>
                                <div className="flex gap-2">
                                    {editando && (
                                        <button onClick={() => { eliminarItem('gastos', editando.id); cerrarFormGasto(); }} className="flex-1 py-3 bg-red-100 text-red-600 font-bold rounded-xl">
                                            üóëÔ∏è Eliminar
                                        </button>
                                    )}
                                    <button onClick={guardarGasto} className="flex-1 py-3 bg-red-500 text-white font-bold rounded-xl">
                                        {editando ? 'üíæ GUARDAR' : 'GUARDAR GASTO'}
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Visor de fotos */}
                    <div className={`photo-modal ${showPhotoModal ? 'open' : ''}`} onClick={() => setShowPhotoModal(null)}>
                        <button className="absolute top-4 right-4 text-white p-2 bg-black/50 rounded-full">‚úï</button>
                        {showPhotoModal && <img src={showPhotoModal} />}
                    </div>
                </>
            );
        }

        function LoginScreen({ onLogin }) {
            const [email, setEmail] = useState('');
            const [nombre, setNombre] = useState('');
            const [isLogin, setIsLogin] = useState(true);

            const handleSubmit = (e) => {
                e.preventDefault();
                onLogin(email, nombre || email.split('@')[0]);
            };

            return (
                <div className="flex-1 flex items-center justify-center bg-slate-900 p-6">
                    <div className="w-full max-w-sm bg-white rounded-3xl p-8 shadow-2xl">
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center">
                                <span className="text-white text-3xl font-black">OP</span>
                            </div>
                            <h1 className="text-2xl font-black text-slate-800">ObraPro</h1>
                            <p className="text-slate-500 text-sm">Gesti√≥n de obras simplificada</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            {!isLogin && (
                                <input placeholder="Tu nombre" value={nombre} onChange={e => setNombre(e.target.value)} className="w-full" />
                            )}
                            <input type="email" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} required className="w-full" />
                            <input type="password" placeholder="Contrase√±a" required className="w-full" />
                            <button type="submit" className="w-full py-4 bg-blue-600 text-white font-bold rounded-xl shadow-lg">
                                {isLogin ? 'INICIAR SESI√ìN' : 'CREAR CUENTA'}
                            </button>
                        </form>

                        <p className="text-center mt-6 text-sm text-slate-500">
                            {isLogin ? '¬øNo tienes cuenta? ' : '¬øYa tienes cuenta? '}
                            <button onClick={() => setIsLogin(!isLogin)} className="text-blue-600 font-bold">
                                {isLogin ? 'Reg√≠strate' : 'Inicia sesi√≥n'}
                            </button>
                        </p>
                    </div>
                </div>
            );
        }

        function VistaLista({ titulo, items, onBack, onEdit, onDelete, renderItem }) {
            return (
                <main className="flex-1 overflow-y-auto no-scrollbar p-4 bg-slate-100">
                    <div className="flex items-center gap-4 mb-4">
                        <button onClick={onBack} className="p-2 bg-white rounded-full">‚Üê</button>
                        <h2 className="text-xl font-bold text-slate-800">{titulo}</h2>
                    </div>
                    {items.length === 0 ? (
                        <p className="text-center text-slate-400 py-10">No hay registros</p>
                    ) : (
                        items.map(item => (
                            <div key={item.id} className="ios-card p-4 mb-3 flex justify-between items-center">
                                {renderItem(item)}
                                <div className="item-actions ml-4">
                                    <button onClick={() => onEdit(item)} className="btn-icon btn-edit" title="Editar">‚úèÔ∏è</button>
                                    <button onClick={() => onDelete(item.id)} className="btn-icon btn-delete" title="Eliminar">üóëÔ∏è</button>
                                </div>
                            </div>
                        ))
                    )}
                </main>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
